import XCTest
@testable import SwiftCompilerArguments

class SwiftCompilerArgumentsTests: XCTestCase {
    func testInvariant0() {
        let originalArguments = "-incremental -module-name SwiftCompilerArguments -Onone -enforce-exclusivity=checked -DSWIFT_PACKAGE -DXcode -sdk /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk -target x86_64-apple-macosx10.10 -g -module-cache-path /Users/ainopara/Library/Developer/Xcode/DerivedData/ModuleCache -Xfrontend -serialize-debugging-options -enable-testing -index-store-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Index/DataStore -swift-version 4 -I /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Products/Debug -F /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Products/Debug -F /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/Library/Frameworks -c -j8 /Users/ainopara/Documents/Projects/SwiftCompilerArguments/Sources/SwiftCompilerArguments/JSONModelEncoder.swift /Users/ainopara/Documents/Projects/SwiftCompilerArguments/Sources/SwiftCompilerArguments/ArgumentParser.swift /Users/ainopara/Documents/Projects/SwiftCompilerArguments/Sources/SwiftCompilerArguments/SwiftCompilerArguments.swift -output-file-map /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug/SwiftCompilerArguments.build/Objects-normal/x86_64/SwiftCompilerArguments-OutputFileMap.json -parseable-output -serialize-diagnostics -emit-dependencies -emit-module -emit-module-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug/SwiftCompilerArguments.build/Objects-normal/x86_64/SwiftCompilerArguments.swiftmodule -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug/SwiftCompilerArguments.build/swift-overrides.hmap -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Products/Debug/include -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug/SwiftCompilerArguments.build/DerivedSources/x86_64 -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug/SwiftCompilerArguments.build/DerivedSources -emit-objc-header -emit-objc-header-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug/SwiftCompilerArguments.build/Objects-normal/x86_64/SwiftCompilerArguments-Swift.h -Xcc -working-directory/Users/ainopara/Documents/Projects/SwiftCompilerArguments".split(separator: " ").map(String.init)

        let parser = SwiftCompilerArgumentParser()
        do {
            let swiftcArguments = try parser.parse(arguments: originalArguments)
            let dumpedArguments = try parser.parse(arguments: swiftcArguments.arguments())
            XCTAssertEqual(swiftcArguments.arguments(), dumpedArguments.arguments())
            print(swiftcArguments)
        } catch {
            print(error)
        }
    }
    func testInvariant() {
        let originalArguments = "-frontend -c -primary-file /Users/ainopara/Documents/Projects/SwiftCompilerArguments/Sources/SwiftCompilerArguments/SwiftCompilerArguments.swift -target arm64-apple-ios11.0 -Xllvm -aarch64-use-tbi -enable-objc-interop -sdk /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.0.sdk -I /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Products/Debug-iphoneos -F /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Products/Debug-iphoneos -F /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/Frameworks -enable-testing -g -module-cache-path /Users/ainopara/Library/Developer/Xcode/DerivedData/ModuleCache -swift-version 4 -enforce-exclusivity=checked -D SWIFT_PACKAGE -D Xcode -serialize-debugging-options -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/swift-overrides.hmap -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Products/Debug-iphoneos/include -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/DerivedSources/arm64 -Xcc -I/Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/DerivedSources -Xcc -working-directory/Users/ainopara/Documents/Projects/SwiftCompilerArguments -emit-module-doc-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/Objects-normal/arm64/SwiftCompilerArguments~partial.swiftdoc -serialize-diagnostics-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/Objects-normal/arm64/SwiftCompilerArguments.dia -Onone -parse-as-library -module-name SwiftCompilerArguments -emit-module-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/Objects-normal/arm64/SwiftCompilerArguments~partial.swiftmodule -emit-dependencies-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/Objects-normal/arm64/SwiftCompilerArguments.d -emit-reference-dependencies-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/Objects-normal/arm64/SwiftCompilerArguments.swiftdeps -o /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Build/Intermediates.noindex/SwiftCompilerArguments.build/Debug-iphoneos/SwiftCompilerArguments.build/Objects-normal/arm64/SwiftCompilerArguments.o -embed-bitcode-marker -index-store-path /Users/ainopara/Library/Developer/Xcode/DerivedData/SwiftCompilerArguments-gpvtxpjfqribcueuzolpjfulsfnm/Index/DataStore -index-system-modules".split(separator: " ").map(String.init)

        let parser = SwiftCompilerArgumentParser()
        do {
            let swiftcArguments = try parser.parse(arguments: originalArguments)
            let dumpedArguments = try parser.parse(arguments: swiftcArguments.arguments())
            XCTAssertEqual(swiftcArguments.arguments(), dumpedArguments.arguments())
            print(swiftcArguments)
        } catch {
            print(error)
        }
    }


    static var allTests = [
        ("testInvariant", testInvariant),
    ]
}
